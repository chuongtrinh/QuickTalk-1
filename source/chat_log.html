<html>
<head>
	<script type="text/javascript" src="jquery-2.1.0.min.js"></script>
</head>
<body>
<div>

</div>
<script type="text/javascript">
	
	var file_log;
	var username;
	var room;
	function getLogFile() {
		$.ajax({
			url:"chat_log.php",
			dataType: 'json',
			type:"POST",
			data: {mode: "check", name: username, room: room},
			cache:false,
			success: function(response) {
				file_log = response.file;
			}
		});
	}
	function writeLogMsg(msg) {
		$.ajax({
			url:"chat_log.php",
			type:"POST",
			data: {mode: "public", name: username, room: room, text: msg},
			cache:false,
			success: function() {
			}			
		});
	}
	function getLogMsg() {
		var oldscrollHeight = $("#chatbox").attr("scrollHeight") - 20;
		if (file_log) {
			$.ajax({
				url:file_log,
				cache:false,
				success: function(html) {
					$("#chatbox").html(html);
					var newscrollHeight = $("#chatbox").attr("scrollHeight") - 20;
					
					if(newscrollHeight > oldscrollHeight){
						$("#chatbox").animate({ scrollTop: newscrollHeight }, 'normal');
					}               
				}		
			});
		} else {
			$("#chatbox").html("Server down!");
		}
	}
	
	$(document).ready(function() {
		getLogFile();
		var check_msg = setInterval(function() {
			getLogMsg();
		},2000);
	});
</script>
</body>
</html>