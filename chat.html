<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="stylesheet" href="Foundation/css/foundation.css" />
<link rel="stylesheet" href="chat.css" />
</head>


<body>
	<div id="base">
		<div class="row">
			<div class="large-12 columns">
				<div class="row">
					<nav class="top-bar modified data-topbar">
						<ul class="title-area">
							<li class="name">
								<h1><a href="#">Name</a></h1>
							</li>
						</ul>
						<ul class="right">
							<li class="name">
								<h1><a href="#">X</a></h1>
							</li>
						</ul>
						<ul id="min-button" class="right">
							<li class="name">
								<h1><a href="#">_</a></h1>
							</li>
						</ul>
					</nav>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="small-12 columns">
				<ul class="button-group">
					<div class="row">
						<li><a href="" class="button">a</a></li>
						<li><a href="" class="button">A</a></li>
						<li><a href="" class="button">B</a></li>
						<li><a href="" class="button">C</a></li>
					</div>
				</ul>
			</div>
		</div>
		<div class="row">
			<div class="large-12 columns">
				<div id="panel">

				</div>
			</div>
		</div>
		<form>
			<div class="row">
				<div class="large-12 columns">
						<div class="row">
							<div class="large-9 columns">
								<textarea id="textbox" placeholder="Type message here!"></textarea>
							</div>
							<div class="large-3 columns button">Send</div>
						</div>
				</div>
			</div>
		</form>
	</div>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js" type="text/javascript"/>
	<script src="Foundation/js/foundation.min.js" type="text/javascript"/>
	<script>
		$(document).foundation();
	</script>
		<!-- Minimze and Maximize -->
	<script>
		$("#min-button").css('position', 'relative').click(function(){
			if($("#base").css('bottom') == '-450px') {
				$("#base").animate({'bottom': '0px'}, 1000);
				$("#text-input").show("slow");
			}
			else {
				$("#base").animate({'bottom': '-450px'}, 1000);
				$("#text-input").hide("slow");			
			}
		});
	</script>
	<script type="text/javascript">
	
	var file_log;
	var username;
	var room;
	function getLogFile() {
		$.ajax({
			url:"chat_log.php",
			//dataType: 'json',
			type:"POST",
			data: {mode: "check", name: "chuong", room: "poker"},
			cache:false,
			success: function(response) {
				console.log("Successfully!!!");
				file_log = response.file;
				console.log("response: "+response.file);
						$('#panel').html(file_log);
			}
		});
	}
	function writeLogMsg(msg) {
		$.ajax({
			url:"chat_log.php",
			type:"POST",
			data: {mode: "public", name: "chuong", room: "poker", text: "hello !!!!"},
			cache:false,
			success: function() {
			}			
		});
	}
	function getLogMsg() {
		var oldscrollHeight = $("#chatbox").attr("scrollHeight") - 20;
		if (file_log) {
			$.ajax({
				url:file_log,
				cache:false,
				success: function(html) {
					$("#chatbox").html(html);
					var newscrollHeight = $("#chatbox").attr("scrollHeight") - 20;
					
					if(newscrollHeight > oldscrollHeight){
						$("#chatbox").animate({ scrollTop: newscrollHeight }, 'normal');
					}               
				}		
			});
		} else {
			$("#chatbox").html("Server down!");
		}
	}
	$(document).ready(function() {
		getLogFile();

		/*
		var check_msg = setInterval(function() {
			getLogMsg();
		},2000);*/
	});
	</script>

</body>
</html>